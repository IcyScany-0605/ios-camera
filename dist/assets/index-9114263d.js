import{r as c,o as X,a as u,c as v,b as e,d as Y,e as h,f as ye,g as we,t as b,w as F,v as ke,h as G,n as S,F as Ce,i as Se,j as Z,k as Oe}from"./vendor-6a1022ce.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const _ of r.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&l(_)}).observe(document,{childList:!0,subtree:!0});function s(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(a){if(a.ep)return;a.ep=!0;const r=s(a);fetch(a.href,r)}})();const Re=()=>!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),ee=()=>{const d=navigator.userAgent.toLowerCase();return/iphone|ipad|ipod/.test(d)?"ios":/android/.test(d)?"android":/windows|mac|linux/.test(d)?"desktop":"unknown"},$e=async(d={})=>{try{const s={...{video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1},...d};return{success:!0,stream:await navigator.mediaDevices.getUserMedia(s)}}catch(n){console.error("相机权限请求失败:",n);let s="相机启动失败";switch(n.name){case"NotAllowedError":s="相机权限被拒绝，请在浏览器设置中允许访问相机";break;case"NotFoundError":s="未找到相机设备";break;case"NotReadableError":s="相机被其他应用占用";break;case"OverconstrainedError":s="相机不满足要求";break;case"TypeError":s="相机参数错误";break;default:s=`相机错误: ${n.message}`}return{success:!1,error:n.name,message:s}}},Ie=d=>MediaRecorder.isTypeSupported(d),Ue=()=>{const d=["video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm","video/mp4","video/ogg;codecs=theora"];for(const n of d)if(Ie(n))return n;return null},Me=(d,n={})=>{const l={...{mimeType:Ue(),videoBitsPerSecond:25e5,audioBitsPerSecond:128e3},...n};try{return new MediaRecorder(d,l)}catch(a){return console.error("创建媒体录制器失败:",a),null}},D=(d,n)=>{const s=URL.createObjectURL(d),l=document.createElement("a");l.href=s,l.download=n,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(s)},Le=(d,n=.8,s=1920)=>new Promise(l=>{const a=new Image;a.onload=()=>{const r=document.createElement("canvas"),_=r.getContext("2d");let{width:m,height:f}=a;m>s&&(f=f*s/m,m=s),r.width=m,r.height=f,_.drawImage(a,0,0,m,f);const y=r.toDataURL("image/jpeg",n);l(y)},a.src=d}),Pe=async d=>{try{const n=d.getVideoTracks()[0],s=n.getCapabilities(),l=n.getSettings();return{capabilities:s,settings:l,currentResolution:{width:l.width,height:l.height}}}catch(n){return console.error("获取相机能力失败:",n),null}};const N=(d,n)=>{const s=d.__vccOpts||d;for(const[l,a]of n)s[l]=a;return s},Te={key:0,class:"ios-helper"},Ae={__name:"IOSCameraHelper",emits:["permission-retry"],setup(d,{expose:n,emit:s}){const l=c(!1),a=c(!1);X(()=>{a.value=ee()==="ios"});const r=async()=>{try{(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(w=>w.stop()),l.value=!1,y("permission-retry")}catch{console.log("权限仍然被拒绝，显示帮助信息")}},_=()=>{a.value?alert('在Safari中，点击分享按钮，然后选择"添加到主屏幕"'):alert("此功能仅在iOS设备上可用")},m=()=>{l.value=!1};n({showHelper:()=>{l.value=!0}});const y=s;return($,w)=>l.value?(u(),v("div",Te,[e("div",{class:"helper-content"},[w[0]||(w[0]=Y('<h3 data-v-99dca25f>📱 iOS相机权限设置</h3><p data-v-99dca25f>为了使用相机功能，请在iOS设备上进行以下设置：</p><div class="steps" data-v-99dca25f><div class="step" data-v-99dca25f><div class="step-number" data-v-99dca25f>1</div><div class="step-content" data-v-99dca25f><h4 data-v-99dca25f>打开设置应用</h4><p data-v-99dca25f>在iOS设备上找到并打开 <strong data-v-99dca25f>设置</strong> 应用</p></div></div><div class="step" data-v-99dca25f><div class="step-number" data-v-99dca25f>2</div><div class="step-content" data-v-99dca25f><h4 data-v-99dca25f>找到浏览器设置</h4><p data-v-99dca25f>向下滚动找到 <strong data-v-99dca25f>Safari</strong> 或你正在使用的浏览器</p></div></div><div class="step" data-v-99dca25f><div class="step-number" data-v-99dca25f>3</div><div class="step-content" data-v-99dca25f><h4 data-v-99dca25f>允许相机访问</h4><p data-v-99dca25f>点击 <strong data-v-99dca25f>相机</strong> 选项，选择 <strong data-v-99dca25f>允许</strong></p></div></div><div class="step" data-v-99dca25f><div class="step-number" data-v-99dca25f>4</div><div class="step-content" data-v-99dca25f><h4 data-v-99dca25f>刷新页面</h4><p data-v-99dca25f>返回浏览器，刷新页面重试</p></div></div></div><div class="ios-tips" data-v-99dca25f><h4 data-v-99dca25f>💡 iOS使用提示：</h4><ul data-v-99dca25f><li data-v-99dca25f>确保在Safari或支持PWA的浏览器中使用</li><li data-v-99dca25f>首次访问时会弹出权限请求，请选择&quot;允许&quot;</li><li data-v-99dca25f>如果权限被拒绝，需要手动在设置中开启</li><li data-v-99dca25f>建议将应用添加到主屏幕以获得最佳体验</li></ul></div>',4)),e("div",{class:"actions"},[e("button",{onClick:r,class:"retry-btn"},"🔄 重试权限"),e("button",{onClick:_,class:"home-btn"},"📱 添加到主屏幕"),e("button",{onClick:m,class:"close-btn"},"关闭")])])])):h("",!0)}},Ve=N(Ae,[["__scopeId","data-v-99dca25f"]]);const De={class:"camera-container"},Ee={class:"camera-header"},He={class:"device-info"},je={class:"device-badge"},xe={key:0,class:"resolution-badge"},Be={class:"camera-controls"},Fe=["disabled"],Ne=["disabled"],qe={key:0,class:"settings-panel"},ze={class:"settings-grid"},Qe={class:"setting-item"},Ke={class:"setting-item"},Je={class:"setting-item"},We={class:"camera-view"},Ge={key:0,class:"camera-placeholder"},Xe={key:1,class:"camera-overlay"},Ye={key:0,class:"recording-indicator"},Ze={class:"camera-stats"},et={class:"camera-actions"},tt={class:"mode-switch"},st={class:"capture-controls"},at=["disabled"],ot=["disabled"],nt=["disabled"],lt={key:1,class:"media-preview"},it={class:"preview-header"},rt={class:"media-grid"},ct=["src","alt","onClick"],dt=["src","onClick"],ut={class:"media-info"},vt={class:"media-type"},pt={class:"media-time"},ft=["onClick"],mt={key:2,class:"permission-error"},ht={key:3,class:"help-modal"},gt={class:"help-content"},bt={__name:"Camera",setup(d){const n=c(null),s=c(!1),l=c(!1),a=c(!1),r=c(!1),_=c(!1),m=c("photo"),f=c([]),y=c(!1),$=c(""),w=c(!1),E=c(!1),H=c("unknown"),L=c(null),P=c("medium"),T=c(!1),U=c(!0),j=c("00:00"),q=c(0),te=c(0);let k=null,C=null,x=[],O=null,A=null,R=null;const se=ye(()=>Re()),I=async()=>{try{const o={video:{facingMode:a.value?"user":"environment",width:{ideal:ae()},height:{ideal:oe()}},audio:T.value},t=await $e(o);t.success?(k=t.stream,n.value&&(n.value.srcObject=k,s.value=!0,y.value=!1,L.value=await Pe(k),ie())):(y.value=!0,$.value=t.message)}catch(o){console.error("相机启动失败:",o),y.value=!0,$.value="相机启动失败，请检查设备权限"}},ae=()=>{switch(P.value){case"low":return 1280;case"high":return 3840;default:return 1920}},oe=()=>{switch(P.value){case"low":return 720;case"high":return 2160;default:return 1080}},ne=()=>{s.value&&(M(),I())},le=()=>{s.value&&(M(),I())},ie=()=>{let o=0,t=performance.now();A=setInterval(()=>{const i=performance.now(),p=i-t;p>0&&(q.value=Math.round(o*1e3/p)),o=0,t=i},1e3)},M=()=>{k&&(k.getTracks().forEach(o=>o.stop()),k=null),s.value=!1,l.value=!1,r.value=!1,O&&(clearInterval(O),O=null),A&&(clearInterval(A),A=null),R&&(clearInterval(R),R=null)},re=async()=>{a.value=!a.value,s.value&&(M(),await I())},ce=()=>{_.value=!_.value},B=o=>{m.value=o,s.value&&o==="video"&&(M(),I())},z=async()=>{if(!s.value)return;const o=document.createElement("canvas"),t=o.getContext("2d"),i=n.value;o.width=i.videoWidth,o.height=i.videoHeight,a.value&&(t.scale(-1,1),t.translate(-o.width,0)),t.drawImage(i,0,0);let p=o.toDataURL("image/jpeg",.9);U.value&&(p=await Le(p,.8,1920));const g={type:"photo",url:p,timestamp:new Date().toISOString()};if(f.value.push(g),U.value){const V=`photo_${Date.now()}.jpg`,_e=await J(p);D(_e,V)}},de=()=>{l.value?ve():ue()},ue=()=>{if(!k)return;if(x=[],C=Me(k,{audio:T.value}),!C){alert("不支持视频录制");return}C.ondataavailable=t=>{t.data.size>0&&x.push(t.data)},C.onstop=()=>{const t=new Blob(x,{type:C.mimeType}),p={type:"video",url:URL.createObjectURL(t),timestamp:new Date().toISOString()};if(f.value.push(p),U.value){const g=`video_${Date.now()}.webm`;D(t,g)}},C.start(),l.value=!0;let o=0;O=setInterval(()=>{o++;const t=Math.floor(o/60),i=o%60;j.value=`${t.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},1e3)},ve=()=>{C&&l.value&&(C.stop(),l.value=!1,O&&(clearInterval(O),O=null,j.value="00:00"))},pe=()=>{r.value?(r.value=!1,R&&(clearInterval(R),R=null)):(r.value=!0,R=setInterval(()=>{r.value&&z()},200))},Q=o=>{console.log("预览媒体:",o)},fe=o=>{const t=f.value[o];t.type==="video"&&URL.revokeObjectURL(t.url),f.value.splice(o,1)},me=async()=>{for(let o=0;o<f.value.length;o++){const t=f.value[o],i=`${t.type}_${o+1}_${Date.now()}.${t.type==="photo"?"jpg":"webm"}`;if(t.type==="photo"){const p=await J(t.url);D(p,i)}else{const g=await(await fetch(t.url)).blob();D(g,i)}}},he=()=>{confirm("确定要清空所有拍摄内容吗？")&&(f.value.forEach(o=>{o.type==="video"&&URL.revokeObjectURL(o.url)}),f.value=[])},ge=o=>new Date(o).toLocaleTimeString(),K=()=>{y.value=!1,I()},be=()=>{var o;H.value==="ios"?(o=W.value)==null||o.showHelper():E.value=!0},J=o=>{const t=o.split(","),i=t[0].match(/:(.*?);/)[1],p=atob(t[1]);let g=p.length;const V=new Uint8Array(g);for(;g--;)V[g]=p.charCodeAt(g);return new Blob([V],{type:i})},W=c(null);return X(()=>{if(H.value=ee(),!se.value){alert("您的设备不支持相机功能");return}}),we(()=>{M()}),(o,t)=>(u(),v("div",De,[e("div",Ee,[t[8]||(t[8]=e("h2",null,"📷 相机",-1)),e("div",He,[e("span",je,b(H.value),1),L.value?(u(),v("span",xe,b(L.value.currentResolution.width)+"×"+b(L.value.currentResolution.height),1)):h("",!0)]),e("div",Be,[e("button",{onClick:re,class:"control-btn",disabled:!s.value}," 🔄 切换相机 ",8,Fe),e("button",{onClick:ce,class:"control-btn",disabled:!s.value},b(_.value?"💡 关闭闪光灯":"💡 开启闪光灯"),9,Ne),e("button",{onClick:t[0]||(t[0]=i=>w.value=!w.value),class:"control-btn"}," ⚙️ 设置 ")])]),w.value?(u(),v("div",qe,[t[13]||(t[13]=e("h3",null,"相机设置",-1)),e("div",ze,[e("div",Qe,[t[10]||(t[10]=e("label",null,"视频质量:",-1)),F(e("select",{"onUpdate:modelValue":t[1]||(t[1]=i=>P.value=i),onChange:ne},[...t[9]||(t[9]=[e("option",{value:"low"},"低质量 (720p)",-1),e("option",{value:"medium"},"中等质量 (1080p)",-1),e("option",{value:"high"},"高质量 (4K)",-1)])],544),[[ke,P.value]])]),e("div",Ke,[t[11]||(t[11]=e("label",null,"音频录制:",-1)),F(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=i=>T.value=i),onChange:le},null,544),[[G,T.value]])]),e("div",Je,[t[12]||(t[12]=e("label",null,"自动保存:",-1)),F(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=i=>U.value=i)},null,512),[[G,U.value]])])])])):h("",!0),e("div",We,[e("video",{ref_key:"videoRef",ref:n,autoplay:"",playsinline:"",muted:"",class:S(["camera-video",{mirrored:a.value}])},null,2),s.value?h("",!0):(u(),v("div",Ge,[e("div",{class:"placeholder-content"},[t[14]||(t[14]=e("div",{class:"camera-icon"},"📷",-1)),t[15]||(t[15]=e("p",null,"点击下方按钮启动相机",-1)),e("button",{onClick:I,class:"start-btn"},"启动相机")])])),s.value?(u(),v("div",Xe,[l.value?(u(),v("div",Ye,[t[16]||(t[16]=e("div",{class:"recording-dot"},null,-1)),e("span",null,"录制中... "+b(j.value),1)])):h("",!0),t[17]||(t[17]=Y('<div class="camera-grid" data-v-8522e7f5><div class="grid-line horizontal" data-v-8522e7f5></div><div class="grid-line horizontal" data-v-8522e7f5></div><div class="grid-line vertical" data-v-8522e7f5></div><div class="grid-line vertical" data-v-8522e7f5></div></div>',1)),e("div",Ze,[e("span",null,"FPS: "+b(q.value),1),e("span",null,"延迟: "+b(te.value)+"ms",1)])])):h("",!0)]),e("div",et,[e("div",tt,[e("button",{onClick:t[4]||(t[4]=i=>B("photo")),class:S(["mode-btn",{active:m.value==="photo"}])}," 📸 拍照 ",2),e("button",{onClick:t[5]||(t[5]=i=>B("video")),class:S(["mode-btn",{active:m.value==="video"}])}," 🎥 录像 ",2),e("button",{onClick:t[6]||(t[6]=i=>B("burst")),class:S(["mode-btn",{active:m.value==="burst"}])}," 🔥 连拍 ",2)]),e("div",st,[m.value==="photo"?(u(),v("button",{key:0,onClick:z,class:"capture-btn photo-btn",disabled:!s.value}," 📸 ",8,at)):h("",!0),m.value==="video"?(u(),v("button",{key:1,onClick:de,class:S(["capture-btn video-btn",{recording:l.value}]),disabled:!s.value},b(l.value?"⏹️":"🎥"),11,ot)):h("",!0),m.value==="burst"?(u(),v("button",{key:2,onClick:pe,class:S(["capture-btn burst-btn",{active:r.value}]),disabled:!s.value}," 🔥 ",10,nt)):h("",!0)])]),f.value.length>0?(u(),v("div",lt,[e("div",it,[e("h3",null,"已拍摄内容 ("+b(f.value.length)+")",1),e("div",{class:"preview-actions"},[e("button",{onClick:me,class:"action-btn"},"📥 下载全部"),e("button",{onClick:he,class:"action-btn danger"}," 🗑️ 清空全部 ")])]),e("div",rt,[(u(!0),v(Ce,null,Se(f.value,(i,p)=>(u(),v("div",{key:p,class:"media-item"},[i.type==="photo"?(u(),v("img",{key:0,src:i.url,alt:`照片 ${p+1}`,onClick:g=>Q(i)},null,8,ct)):(u(),v("video",{key:1,src:i.url,controls:"",onClick:g=>Q(i)},null,8,dt)),e("div",ut,[e("span",vt,b(i.type==="photo"?"📸":"🎥"),1),e("span",pt,b(ge(i.timestamp)),1)]),e("button",{onClick:g=>fe(p),class:"delete-btn"},"🗑️",8,ft)]))),128))])])):h("",!0),y.value?(u(),v("div",mt,[t[18]||(t[18]=e("h3",null,"⚠️ 相机权限被拒绝",-1)),e("p",null,b($.value),1),e("div",{class:"error-actions"},[e("button",{onClick:K,class:"retry-btn"},"重试"),e("button",{onClick:be,class:"help-btn"},"查看帮助")])])):h("",!0),E.value?(u(),v("div",ht,[e("div",gt,[t[19]||(t[19]=e("h3",null,"📱 相机权限设置",-1)),t[20]||(t[20]=e("ol",null,[e("li",null,"打开浏览器设置"),e("li",null,"找到相机权限设置"),e("li",null,"选择允许访问"),e("li",null,"刷新页面重试")],-1)),e("button",{onClick:t[7]||(t[7]=i=>E.value=!1),class:"close-btn"},"关闭")])])):h("",!0),Z(Ve,{ref_key:"iosHelperRef",ref:W,onPermissionRetry:K},null,512)]))}},_t=N(bt,[["__scopeId","data-v-8522e7f5"]]);const yt={id:"app"},wt={class:"navigation"},kt={class:"main"},Ct={key:0,class:"home-content"},St={class:"card"},Ot={key:1},Rt={__name:"App",setup(d){const n=c(0),s=c("home");return(l,a)=>(u(),v("div",yt,[a[6]||(a[6]=e("header",{class:"header"},[e("h1",null,"📷 Camera App"),e("p",null,"基于 Vue 3 + Vite 构建的现代化应用")],-1)),e("nav",wt,[e("button",{onClick:a[0]||(a[0]=r=>s.value="home"),class:S(["nav-btn",{active:s.value==="home"}])}," 🏠 首页 ",2),e("button",{onClick:a[1]||(a[1]=r=>s.value="camera"),class:S(["nav-btn",{active:s.value==="camera"}])}," 📷 相机 ",2)]),e("main",kt,[s.value==="home"?(u(),v("div",Ct,[e("div",St,[a[3]||(a[3]=e("h2",null,"欢迎使用 Vue 3!",-1)),a[4]||(a[4]=e("p",null,"这是一个使用最新技术栈构建的Vue应用。",-1)),e("button",{onClick:a[2]||(a[2]=r=>n.value++),class:"btn"},"点击次数: "+b(n.value),1)]),a[5]||(a[5]=e("div",{class:"features"},[e("div",{class:"feature"},[e("h3",null,"⚡ Vite"),e("p",null,"极速的开发服务器和构建工具")]),e("div",{class:"feature"},[e("h3",null,"🎯 Vue 3"),e("p",null,"渐进式JavaScript框架")]),e("div",{class:"feature"},[e("h3",null,"🔧 现代化工具链"),e("p",null,"ESLint + Prettier 代码质量保证")])],-1))])):h("",!0),s.value==="camera"?(u(),v("div",Ot,[Z(_t)])):h("",!0)])]))}},$t=N(Rt,[["__scopeId","data-v-c08b7f6a"]]);Oe($t).mount("#app");
